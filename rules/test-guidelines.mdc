---
description: Guideline as to how to write tests. Read this before adding or modifying tests
globs:
alwaysApply: false
---
## BDD
All tests use the BDD format with Gherkin feature files in `features/`.

### Framework selection
- **Unit/Integration tests** (`features/unit/`, `features/integration/`): Use **quickpickle** with vitest. Steps in `tests/steps/`. Run with `npm run test:unit`.
- **E2E tests** (`features/e2e/`): Use **playwright-bdd** with Playwright. Steps in `tests/e2e/steps/`. Run with `npm run test:e2e`.

### Step definitions
All step definitions must have valid TypeScript types on parameters and return types.

## Test cases
Test cases should focus on behavior and NOT on implementation details. If a method underlying code changes without impact on visible behavior, it should not break tests. This is why we limit mock usage to the minimum needed

## Mock usage
Mocks usage must be reduced to its minimum. Limit mock usage to outside dependancies that we do not want to call during automated testing, such as databases and apis. Mocking of user code should be extremely rare. If you believe it to be necessary, validate with the user.

## Changing the codebase
Do not add something to the codebase simply because a test fail. Reflect as to what the correct behavior should be. If in doubt, ask the user.

Example: If your test try to pass a None value to a function that do not accept None value, DO NOT CHANGE THE FUNCTION TO ACCEPT NONE, change or remove the test.

Do not add production code solely for test purposes. If you need set up code, let it live in the tests folder.
